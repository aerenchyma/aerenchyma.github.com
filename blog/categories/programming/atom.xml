<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: programming | aerenchyma]]></title>
  <link href="http://aerenchyma.github.io/blog/categories/programming/atom.xml" rel="self"/>
  <link href="http://aerenchyma.github.io/"/>
  <updated>2013-10-25T00:40:09-04:00</updated>
  <id>http://aerenchyma.github.io/</id>
  <author>
    <name><![CDATA[Jackie Cohen]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Recipe formatting]]></title>
    <link href="http://aerenchyma.github.io/blog/2013/07/15/recipe-formatting/"/>
    <updated>2013-07-15T18:21:00-04:00</updated>
    <id>http://aerenchyma.github.io/blog/2013/07/15/recipe-formatting</id>
    <content type="html"><![CDATA[<h2>the what</h2>

<p>Almost four years ago, I was having a discussion with a friend about recipes: we determined that ideally, ingredient amounts should be integrated into recipe directions as well as in a list at the beginning of the recipe for shopping/gathering/whatever. Rather than looking at "Now, add rice vinegar" and flipping gaze back to the beginning to see just how much, it should say "add 1/4 cup rice vinegar" right in the instructions.</p>

<p>We talked about compiling recipes this way, about indexing them in useful ways; by ingredient, dietary preference alignment, allergy compliance, and how you should scale them for a thirty-person cooperative. I thought about doing it programmatically; I'd begun to learn Python a few months before. I shook my head, at the time: it sounded so difficult, and I thought maybe later.</p>

<p>A few weeks ago, it seemed a lot more doable. The overhead on web scraping feels lighter now: I've done it a whole lot more. My attitude toward solving problems is neither less nor more enthusiastic four years later (freaking love 'em then and now) but it is significantly more confident. I felt that the problem would be less overwhelming now.</p>

<p>Less overwhelming, perhaps. It still turns out to be hard.</p>

<!-- more -->


<p>But it's a fun problem, and an interesting one, because challenging pieces continue to rise to the surface -- not as sudden "oh, crap!" surprises, but slowly looming challenges of various size.</p>

<p>I decided to attempt only parsing recipes from the site <a href="http://www.allrecipes.com">AllRecipes</a>, in order to be able to scrape reliably and not turn it into as much of a Machine Learning problem (what's an ingredient, etc) or add another layer of a parsing problem to the challenge. Even with this limit, it's not <em>easy</em>. (A few issues remain unsolved with the method I used.)</p>

<h2>the how</h2>

<p>I wrote my current attempt in Python, doing the scraping with <a href="https://beautiful-soup-4.readthedocs.org/en/latest/">BeautifulSoup</a>.</p>

<p>Most of it is currently being done via a procedural script. I use one helper function that I call <code>word_sans_comma(w)</code> in order to strip words of punctuation non-destructively, needing a function because strings are, of course, immutable in Python.</p>

<p>To test, I save the brief version of an AllRecipes URL in a <code>test_recipe</code> variable to save me typing or entering otherwise. I tested several recipes, with different ingredients, to try and catch bugs, which I'll address shortly. For one example, there's <code>http://allrecipes.com/Recipe/Chicken-Pot-Pie-IX/</code>.</p>

<p>I also have pre-compiled lists of words, which need to be gathered in more responsible ways: stopwords (things like "in", "on", "and"; words that don't add much to meaning individually and don't help in searches), meat words (e.g. "chicken" or "beef", words that indicate there are meat products in the recipe), dairy words (I assume we get the picture), and other non-vegan words which don't fall into any of the former categories (right now only including "egg" -- I welcome other suggestions).</p>

<p>I open the recipe page and create a <code>soup</code> instance with BeautifulSoup, pull out the title and the number of servings. I find the part of the page that lists ingredients with <code>test_ingr = rec_doc.findAll("p", {"class" : "fl-ing"})</code>. (See <a href="https://github.com/aerenchyma/allrecipe_parsing">the code</a>.) Or in English, <em>find all the occurrences of <code>&lt;p class="fl-ing"&gt;&lt;/p&gt;</code> tags on the page.</em></p>

<p>I iterate through the list I get in <code>test_ingr</code>, and if it includes a name and a discrete amount (1/2 cup, 1 pinch, whatever -- they're all labeled with the HTML id <code>lblIngAmount</code>, while the ingredient names all are wrapped within a tag id'd <code>lblIngName</code>), I add these things to a Python dictionary of ingredients where the Key:Value pairs are Ingredient-Name:Ingredient-Amount.</p>

<p>Using <code>.findAll()</code> means I will get a return value of a Python list, so right there I have what I need: each of the ingredients, with their respective amounts.</p>

<p>The ingredient directions on AllRecipes recipes are wrapped in their own <code>div</code>. I split up the directions into words with Python's <code>.split()</code>, and iterate through the non-stopwords in the resulting list. I am concerned with a few things during this iteration:</p>

<ol>
<li><p>I avoid all simple past verbs (many things can be "chopped" or "sliced" so it worked best not to consider these when looking for places in the directions where amounts or fuller ingredient descriptions needed to be inserted).</p></li>
<li><p>Whether my boolean variables <code>vegan</code> and <code>non-dairy</code> should be turned False: are any of these words in my meat words or dairy words lists? (Common allergies are another set of categories I'm likely to add in the future.)</p></li>
<li><p>In a show of relatively poor performance (only speedwise -- it detracts from the speed of a run, but not noticeably for these purposes<sup id='fnref:1'><a href='#fn:1' rel='footnote'>1</a></sup>), I loop through the ingredients in the dictionary of ingredients I created earlier, in a nested loop.</p></li>
</ol>


<p>I split each ingredient name into a Python list of individual words and compare these words, without punctuation (using my <code>word_sans_comma(w)</code> function), to each relevant word in the ingredient directions. If it's a match, I replace that word in the directions with the string composed of [INGREDIENT AMOUNT] + [INGREDIENT NAME (as listed in the original ingredients dictionary)], correct for punctuation as needed, and fix punctuation issues. For example, if the directions state</p>

<p><code>stir in the pasta, then add the lemon</code></p>

<p>you'd want that comma, e.g. <code>stir in the 1/2 lb of whole wheat pasta, then ...</code> is better than <code>stir in the 1/2 lb of whole wheat pasta then add the lemon</code>. The former reads more clearly (to me, anyway).</p>

<p>I need that <code>word_sans_comma</code> function in order to compare words without attached punctuation to other similarly unencumbered words, but retain the original, punctuation-ful strings for the final result. It'd be pretty ugly to take out all the commas and periods from a recipe in order to insert ingredient amounts in the directions. The varying ways in which punctuation is used contributes to a lot of hard and interesting linguistics problems (not only computational), and it certainly contributes here. Among others, <a href="http://books.google.com/books/about/The_Linguistics_of_Punctuation.html?id=Sh-sruuKjJwC">Geoffrey Nunberg wrote about this</a>.</p>

<p>Finally, if any words remain doubled, I remove one of the occurrences of the word. For example, if the directions read <code>take the chicken, chopped ...</code> then replacing that to result in <code>take the 2 chicken breasts, chopped chopped</code> is unfortunate.</p>

<p>I separate the sentences in the directions into lines, and write the recipe title, dietary preference categories, serving number, and enhanced line-by-line directions to a file.</p>

<p>(I'm still deciding on what I want my LaTeX template for these purposes to look like, so at the moment it's a text file, but a much clearer text file than the print version of most of these recipes.)</p>

<p>Upcoming: pretty TeX, better indexing, allergy categorization, hosting, removal of awkwardness (e.g. replacing the phrase "parsley" with "1/2 cup freshly chopped, bright green parsley" six times in a row -- it's not <em>necessarily</em> inaccurate, but it's certainly annoying), and an issues list on GitHub to keep track of these things outside my personal issue tracker.</p>

<p>You can see the code <a href="https://github.com/aerenchyma/allrecipe_parsing">here</a>.</p>

<h2>the issues</h2>

<p>In discussions with variously similarly-minded people, most of the solutions proposed for this problem of re-laying-out AllRecipes' recipes are either much like mine, involve using a full parser, or involve employing a variety of minimum edit distance in combination with part of my solution. Each of these ideas for solutions offer their own advantages and their own problems. Most notably, I think, none makes it easy, and none seems to make the problems invisible.</p>

<p>The most significant issues remaining in mine are three (or four, depending upon how you separate them).</p>

<ul>
<li><strong>Clarity.</strong></li>
</ul>


<p>The example I gave earlier about chopped chicken and accidental word-reduplication is sometimes particularly problematic. What if the original recipe states <code>put the chopped chicken in the pan</code> and the ingredient list includes <code>2 chicken breasts, chopped</code>? The current algorithm may result in <code>put the chopped 2 chicken breasts, chopped</code>. Bad.</p>

<p>With the current algorithm, replacing also occurs in places it ought not, creating some problematic sentences (this problem often overlaps with the awkwardness of multiple insertions of a long ingredient phrase that I refer to above). My favorite resulting gem: <em>Continue baking until cheese is melted and 4 skinless, boneless chicken breast halves juices run clear</em>.</p>

<p>Yay, evaluation.</p>

<ul>
<li><strong>Amount separation.</strong></li>
</ul>


<p>This algorithm does not account at all for occurrences of splitting up an amount of a single type of ingredient. For example, if a recipe calls for 2 cups of sugar but has you <em>stir in 1.5 cups of sugar</em> at the beginning of the process, then <em>sprinkle 1/2 cup of sugar</em> on top at the end of the preparations, this will turn your recipe pretty confusing.</p>

<ul>
<li><strong>Overlapping names.</strong></li>
</ul>


<p>Celery and celery seed are two different ingredients. Until common bigrams (or better parsing mechanisms?) are implemented, this code will treat both occurrences of the word "celery" the same, though. You'll see this, if you try the chicken pot pie recipe. I tilted my head at it for a moment and then laughed, adding to the list.</p>

<p>This happens only when the shared token ("celery", in this case) comes first in a phrase: for instance, it's fine if a recipe includes both <em>shredded mozzarella</em> and <em>smoked mozzarella</em><sup id='fnref:2'><a href='#fn:2' rel='footnote'>2</a></sup>, because replacing happens on first occurrence. This is a Big Bad Problem, but I found it interesting that it came up as late as it did; it's not a terribly unusual case.</p>

<h2>takeaways</h2>

<ul>
<li><p>Even if you're really familiar with a language, its gotchas may still get you. (I spent more than a second wondering why Python's <code>.replace()</code> was working the way it was, though I've probably used it thousands of times.)</p></li>
<li><p>Tiny human problems are often fun ones: I can't honestly say that I've used this often in the weeks since it's existed on my hard drive, but I've used it more than once -- and I've certainly thought about it.</p></li>
<li><p>Language is amazing. NLP, and issues I've thought about and written about as both a linguist and a programmer repeatedly arise, even when I don't come at a problem thinking it's a <em>language parsing problem</em>. A <em>lot</em> of things are language parsing problems, I am finding. Recipes rely so much on human knowledge! Every day I come up with a new angle on my senior thesis from years ago (that's another story entirely).</p></li>
<li><p>Evaluation is a hard problem. When I told people about this and they proposed a different solution, I spent a couple minutes thinking <em>oh, duh</em> -- and realized it wasn't obvious at all. Maybe their solutions result in problems that generate less confusion, or less amusement (that's an inclusive OR). Certainly there are more elegant ways to write this, in fewer lines of code, such that it will run faster, relying on different architecture. But none of them solve everything, insofar as I can tell, without more time. It's not a snap-your-fingers-problem.</p></li>
<li><p>And I've learned a lot. I couldn't do this in any kind of hasty side-project kinda way four years ago: I wasn't comfortable enough just <em>playing.</em> It seemed so serious, like so much to hold in your head. It may not be a simple problem exactly but it isn't overwhelming anymore. I've had a lot of fun discussions about this; the best part, probably, was comparing solutions, because it was possible to hold them in my head and compare them piece-by-piece. It's a, if not <em>the</em>, way I think project-based-learning should go.</p></li>
</ul>


<hr />

<p><div class="footnotes">
	<ol>
		<li id='fn:1'><p> But it's important to be aware I'm doing more looping than necessary -- it's a TODO. I think it's sometimes fun to make things work without immediate concern about performance, but I hesitate to phrase it that way, because it falsely implies that optimizing code isn't fun. Let's just say I'm gettin' there.
<a href='#fnref:1' rev='footnote'>↩</a></p>
</li><li id='fn:2'><p> Assuming, for the sake of this example, that each of these mozzerellas is intended for a different end within the relevant concoction.
<a href='#fnref:2' rev='footnote'>↩</a></p>
</li>
	</ol>
</div>
</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Here at the edge]]></title>
    <link href="http://aerenchyma.github.io/blog/2013/05/25/here-at-the-edge/"/>
    <updated>2013-05-25T21:13:00-04:00</updated>
    <id>http://aerenchyma.github.io/blog/2013/05/25/here-at-the-edge</id>
    <content type="html"><![CDATA[<p><a href="http://www.powells.com/biblio/9780872863323"><em>Close to the Machine</em></a> was published in 1997, which was also the year I first (technically) got access to the Internet and eleven years before I seriously thought about programming myself.</p>

<p>I came across the memoir in 2013, after Ellen Ullman's op-ed <a href="http://nyti.ms/10UrtAc">How to Be a 'Woman Programmer'</a> was published in the New York Times on May 18.</p>

<!-- more -->


<p>The second line of that op-ed reads <em>I wrote code that ran at the levels between flashy human interfaces and the deep cores of operating systems, like the role of altos in a chorus, who provide the structure without your taking much notice of their melodic lines</em>, and I was instantly fascinated. I am interested in all the things she mentions in that sentence, but altos-in-a-chorus-y scripts I recognize as the kind of programming that, so far at least, brings me the most joy. (It's a tough choice.)</p>

<p>This is for reasons Ullman talks about. Describing sitting at a table with clients for a "city-wide database for AIDS service providers," she writes about the disconnect between she herself, a senior programmer tasked with building this system, and the other people around the table: runners of clinics, doctors, dentists, hospice directors. <em>I was there at the edge,</em> she writes, <em>the interface of the system, in all its existence, to the people, in all their existence.</em><sup id='fnref:1'><a href='#fn:1' rel='footnote'>1</a></sup></p>

<p>Right now, that's the most thrilling thing for me about <em>being a programmer</em>, and also the most frustrating. There is so much knowledge I learnt over years that I wish I could convey in a matter of minutes. But my ability to make something that I <em>know</em> makes someone's life easier, watch them use it, and make it better for their use, never gets old.</p>

<p>Still: I don't know others' jobs better than they do. Maybe <em>I</em> think a command-line script will solve a lot of problems but it won't help if the users-to-be are confused by "the command line." And maybe I'm <em>wrong.</em> <a href="https://medium.com/close-to-the-machine/8c2d491886fa">Diana Kimball wrote about arrogance and obsession</a>, and how arrogance can be a tool. This resonates with me. (Sometimes, I'm right.) But the same kind of obsession that makes me happy also scares me. I've walked away from conversations about problem-solving feeling like an ass. <em>I talked, asked questions, but I saw I was operating at a different speed from the people at the table,</em> Ullman writes.<sup id='fnref:2'><a href='#fn:2' rel='footnote'>2</a></sup> That's familiar. Sometimes I'm focusing on a detail that is important for the <em>database</em> but not the users. Sometimes I'm rushing ahead -- this platform, that language, yes yes yes... What?</p>

<p>Many of these tools to switch on are incredibly useful in programming but the opposite when explaining, and so walking the line between the technical and the non-technical (these are terms I hesitate to use) -- say, teaching programming, or working on tech systems for a multi-disciplinary organization -- means careful attention is important. What are my assumptions (today)?</p>

<p>Ellen Ullman gives voice to a lot of the things that scare me, and a lot of the things that I find incredibly exciting. <em>In . . . software engineering, there is something almost shameful in this helpful, social-services system we're building. The whole project smacks of . . . people who just want to use the stuff we write and don't care how we did it.</em><sup id='fnref:3'><a href='#fn:3' rel='footnote'>3</a></sup> I think that I understand what this says, but I don't feel good about understanding it. Yet also, I love that I kind of get it. <em>We had started with some scratchings on a white-board and built this: this operational program, this functional thing.</em><sup id='fnref:4'><a href='#fn:4' rel='footnote'>4</a></sup> That realization, that's <em>amazing.</em> Every time.</p>

<p>I finished <em>Close to the Machine</em> a couple days ago -- a quick read, and one I enjoyed -- and I'm still thinking about it because of precisely this problem. Computer Science often revolves around complexity, but complexity is definitely not unique to it. I talk to my friend, a manager at a non-profit organization, about how a script could speed up tasks. Together, we write something that brings one process from months to days long, but just because programming can speed things up does not mean there isn't always more.</p>

<p>Programming is an <em>awesome</em> tool and also an awesome, awesome practice. But while I believe there is an huge amount of value in all stripes of Computer Science and programming as disciplines -- and do I ever, especially when it's approached the way <a href="http://bit.ly/ZlCrEw">it is at Hacker School</a> -- I also think programming's value depends a great deal on domain expertise. Its use as an awesome tool depends often on the experiences of hospice directors and doctors and runners of clinics. The knowledge of economists, and leaders of campaigns against hunger, and linguists doing fieldwork. Its value is, in my opinion, multiplied exponentially by experience -- not just experience programming, but experience of how an medical clinic worker goes about their day, for instance.</p>

<p>The value of programming depends on willingness to listen. Listening to other programmers is important, but also keeping one foot out of <em>the universe where two human beings can simultaneously understand the statement 'if space is numeric!'</em> matters, sometimes.<sup id='fnref:5'><a href='#fn:5' rel='footnote'>5</a></sup> And yet often the best work is done when absorbed in that universe. These facts coexist, and Ullman's work is one of the first (non-tweet) things I've read that acknowledges this.<sup id='fnref:6'><a href='#fn:6' rel='footnote'>6</a></sup></p>

<p>I liked spending hours in a beige classroom scribbling logic on a chalkboard with other people -- as Ullman puts it, <em>other weird logic-dreamers like myself.</em> It's something I love about programming, and something I loved about <a href="http://www.hackerschool.com/about">Hacker School</a>: there's always more. There's certainly happiness in belonging to a group of people who love something, but there's a danger in homogenizing that love in your head. Because it makes it very easy, then, to keep people <em>out</em> instead of bringing people in. There are infinite kinds of experience, and equally many ways to love something.</p>

<p>If everyone were "a programmer" first, little to nothing would ever get done outside that numeric space universe.</p>

<p>But if more people were "a programmer" by varied definitions, or offered the opportunity to be if they want -- the opportunity to truthfully say 'I've read a line or more of code'? 'I've written a short program'? 'I understand possibilities this tool could offer me'? 'I am committed to making sure a new system works for the people who will need to <em>use</em> it'? 'I will talk to people in technological domains about the complexity <em>I</em> am faced with and hope we can reach common ground', or something else -- then, I think more <em>would</em>. I've seen firsthand that it's useful and interesting to hear about types of complexity I'm unfamiliar with. It isn't because I am a programmer. And this: <em>We build the system, we live in its midst, and we are changed.</em><sup id='fnref:7'><a href='#fn:7' rel='footnote'>7</a></sup> That's certainly not unique to programmers, but I think it's <em>common</em> to them.</p>

<p>That's pretty cool.</p>

<hr />

<p><div class="footnotes">
	<ol>
		<li id='fn:1'><p> Ullman, Ellen. <u>Close to the Machine</u>. Picador: USA. 1997; 2012 reprint. p 12.
<a href='#fnref:1' rev='footnote'>↩</a></p>
</li><li id='fn:2'><p> <em>Ibid.</em>
<a href='#fnref:2' rev='footnote'>↩</a></p>
</li><li id='fn:3'><p> <em>Ibid,</em> p 9.
<a href='#fnref:3' rev='footnote'>↩</a></p>
</li><li id='fn:4'><p> <em>Ibid,</em> p 173.
<a href='#fnref:4' rev='footnote'>↩</a></p>
</li><li id='fn:5'><p> <em>Ibid,</em> p 2.
<a href='#fnref:5' rev='footnote'>↩</a></p>
</li><li id='fn:6'><p> I'm sure there are others/similar and welcome recommendations
<a href='#fnref:6' rev='footnote'>↩</a></p>
</li><li id='fn:7'><p> <em>Ibid,</em> p 30.
<a href='#fnref:7' rev='footnote'>↩</a></p>
</li>
	</ol>
</div>
</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[remote lighting]]></title>
    <link href="http://aerenchyma.github.io/blog/2013/04/21/remote-lighting/"/>
    <updated>2013-04-21T12:01:00-04:00</updated>
    <id>http://aerenchyma.github.io/blog/2013/04/21/remote-lighting</id>
    <content type="html"><![CDATA[<p>This past Friday, I joined forces with a friend for a fun remote lighting project using a Raspberry Pi.</p>

<p>Remote lighting? you say. You know the colored stage lights you see in theatres? If you ever did tech for a production in high school in a small theatre without super-intense equipment, those are the ones we used. They were hooked up via <a href="http://en.wikipedia.org/wiki/DMX_(lighting">DMX</a> ). (See <a href="http://www.opendmx.net/index.php/OLA_Python_API">here</a> for more information about the Python API, which we used.)</p>

<p>Some of these lights were hooked up to a Pi, and the idea was that we would be able to pass a color (e.g. on a color wheel like you might see in Photoshop), and brightness, via a web interface, which would then set the lights on as specified.</p>

<p>Below is the how and the what, and the code. All you need to make this happen is the appropriate lights and wiring (I didn't do this part, so I can't speak to it), a Raspberry Pi, set up with wireless, and a computer with monitor and keyboard input/a laptop that can also access the wireless network.</p>

<!--more-->


<h2>the setup</h2>

<p>We had 4 "normal" lights, and 1 special case light. Each of the four normal lights had four input/output channels. The fifth "special case" light had five channels.</p>

<p>All of them had channels <code>brightness</code>, <code>red</code>, <code>blue</code>, and <code>green</code>. The special case light (a light sort of but not exactly like <a href="http://www.alibaba.com/product-gs/693385417/DMX_18x10W_RGBW_4IN1_Multi_color.html">this</a>) had these four channels, plus a <code>rotation</code> channel.</p>

<p>Each of these channels accepted an integer from 0 - 255 (8-bit encoding).</p>

<p>In the case of each of the colors (red, blue, green), the integers <a href="http://en.wikipedia.org/wiki/RGB_color_model#Additive_primary_colors">represented the color amounts</a> -- for example, <code>red, green, blue = 0, 0, 255</code> would make a light shine pure blue light. <code>red, green, blue = 100, 0, 155</code> would probably result in some shade of purple light.</p>

<p>For the brightness parameter, the 0 - 255 scale was pretty intuitive: 0 meant off, 255 was the brightest the light would go.</p>

<p>And for the special case, the 0 - 255 scale represented the speed of rotation, from off to the fastest it would rotate, about once per second or so (this light also has a flashing option as well as rotation of the beams, but we decided not to include that as an option because the flashing, like strobe lighting, is annoying if not dangerous-for-some).</p>

<p>All five of these lights were hooked up to the Pi and all the appropriate information sent to them, via the Pi. (Of course, being allowed to turn on the rotate option does not make sense if the special case is turned off, but we decided to overlook that for two reasons: (a) the users were only those of us making it, and especially (b) turning rotate on and the special case off was senseless, but would not break anything.)</p>

<h2>the how</h2>

<p>We needed to create the server:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">SocketServer</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">class</span> <span class="nc">MyTCPHandler</span><span class="p">(</span><span class="n">SocketServer</span><span class="o">.</span><span class="n">StreamRequestHandler</span><span class="p">):</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>    <span class="c"># self.rfile is a file-like object created by the handler</span>
</span><span class='line'>    <span class="c"># we can now use e.g. readline() instead of raw recv() calls</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span class='line'>    <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="c"># see what&#39;s going on</span>
</span><span class='line'>    <span class="n">list_vals</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;,&quot;</span><span class="p">)]</span>
</span><span class='line'>    <span class="n">lights_start</span><span class="p">(</span><span class="o">*</span><span class="n">list_vals</span><span class="p">)</span>
</span><span class='line'>    <span class="c"># Likewise, self.wfile is a file-like object used to write back to the client</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">wfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;YES&quot;</span><span class="p">)</span> <span class="c"># acknowledge something&#39;s happening</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>The function in line 10 there, and the functionality from lines 7-9, I'll address shortly.</p>

<p>And at the bottom of the script,</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">HOST</span><span class="p">,</span> <span class="n">PORT</span> <span class="o">=</span> <span class="s">&quot;0.0.0.0&quot;</span><span class="p">,</span> <span class="mi">9999</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">Create</span> <span class="n">the</span> <span class="n">server</span><span class="p">,</span> <span class="n">binding</span> <span class="n">to</span> <span class="n">localhost</span> <span class="n">on</span> <span class="n">port</span> <span class="mi">9999</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">server</span> <span class="o">=</span> <span class="n">SocketServer</span><span class="o">.</span><span class="n">TCPServer</span><span class="p">((</span><span class="n">HOST</span><span class="p">,</span> <span class="n">PORT</span><span class="p">),</span> <span class="n">MyTCPHandler</span><span class="p">)</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">server</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>We also needed to use the <a href="http://www.opendmx.net/index.php/OLA_Python_API">OLA Python API</a> to deal with DMX, which was a simple matter of inspecting and copying over code.</p>

<p>At the top of the file,</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">array</span> <span class="c"># data must be transmitted to DMX in an array</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">ola.ClientWrapper</span> <span class="kn">import</span> <span class="n">ClientWrapper</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>And then, to instantiate a ClientWrapper for OLA and defining a function to deal with it:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">wrapper</span> <span class="o">=</span> <span class="n">ClientWrapper</span><span class="p">()</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">def</span> <span class="nf">DmxSent</span><span class="p">(</span><span class="n">state</span><span class="p">):</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="n">wrapper</span><span class="o">.</span><span class="n">Stop</span><span class="p">()</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>Next, a function to turn on the lights. We assumed we would always want the same color coming from each of the four (or five) lights.</p>

<p>Per the DMX specifications, the data structure we needed to pass was an array (a real array, not a Python list) with values in order for each lights. So the first four integer values in the array corresponded to the values for one normal light: <em>brightness, red, green, blue</em> values. The second would be the same four values, for the second normal light, etc. The special case light came last, in the order <em>brightness, red, green, blue, rotation</em>.</p>

<p>But just appending one after another was easy to lose track of and not pretty. Hence the function:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">lights_do</span><span class="p">(</span><span class="n">bright</span><span class="p">,</span> <span class="n">red</span><span class="p">,</span> <span class="n">green</span><span class="p">,</span> <span class="n">blue</span><span class="p">,</span> <span class="n">rotate</span><span class="p">,</span> <span class="n">sp</span><span class="p">):</span> <span class="c"># the sp parameter is 0 or 1 and indicates whether the special case light goes on or not&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="n">universe</span> <span class="o">=</span> <span class="mi">1</span> <span class="c"># this is required by DMX -- the lights are essentially attributes of &#39;universe 1&#39;</span>
</span><span class='line'><span class="n">data</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s">&#39;B&#39;</span><span class="p">)</span> <span class="c"># also required; see the OLA Python API specs</span>
</span><span class='line'><span class="n">light_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">bright</span><span class="p">,</span> <span class="n">red</span><span class="p">,</span> <span class="n">green</span><span class="p">,</span> <span class="n">blue</span><span class="p">,</span> <span class="n">rotate</span><span class="p">]</span>
</span><span class='line'><span class="n">normal_light</span> <span class="o">=</span> <span class="n">light_data</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c"># for extra clarity</span>
</span><span class='line'><span class="n">tmp</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">normal_light</span><span class="o">*</span><span class="mi">4</span><span class="p">]</span>
</span><span class='line'><span class="k">if</span> <span class="n">sp</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span class='line'>    <span class="n">tmp</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">light_data</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'><span class="n">client</span> <span class="o">=</span> <span class="n">wrapper</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span> <span class="c"># wrapper, above, is global in this script</span>
</span><span class='line'><span class="n">client</span><span class="o">.</span><span class="n">SendDmx</span><span class="p">(</span><span class="n">universe</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">DmxSent</span><span class="p">)</span>
</span><span class='line'><span class="n">wrapper</span><span class="o">.</span><span class="n">Run</span><span class="p">()</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>The use of previously assigned global variables is a little cringe-worthy, but it achieved our purpose, and while I'll make arguments for good practices all the time, the goal of this project was nifty colored lights, to be perfectly honest. Now that we know it works, we'll do some brief polishing (both on the script and the wiring ends, but especially on the interface -- these are in progress).</p>

<p><code>tmp</code> here is obviously a throwaway variable. But the list comprehensions in lines 7 and 9 in that snippet earned me a "that syntax is <em>slick</em>, I admit" from my not-so-much-a-Python-programmer friend. List comprehensions, they are excellent.</p>

<p>It's extremely explicit code in many ways, allowing for Pythonic syntax like the list comprehensions, but I think there's value in that kind of explicitness.</p>

<p>Finally, we needed a wrapper function to handle whether or not the special case was on, so everything would go off or on as appropriate before passing new values to the lights to turn them on/change properties of the input channels (e.g. color, brightness).</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">def</span> <span class="nf">lights_start</span><span class="p">(</span><span class="n">bright</span><span class="p">,</span><span class="n">red</span><span class="p">,</span><span class="n">green</span><span class="p">,</span><span class="n">blue</span><span class="p">,</span><span class="n">rotate</span><span class="p">,</span><span class="n">sp</span><span class="p">):</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="n">lights_do</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'><span class="n">lights_do</span><span class="p">(</span><span class="n">bright</span><span class="p">,</span><span class="n">red</span><span class="p">,</span><span class="n">green</span><span class="p">,</span><span class="n">blue</span><span class="p">,</span><span class="n">rotate</span><span class="p">,</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>So, let's go back to the <code>handle()</code> method of the <code>MyTCPHandler</code> class:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="c"># self.rfile is a file-like object created by the handler</span>
</span><span class='line'><span class="c"># we can now use e.g. readline() instead of raw recv() calls</span>
</span><span class='line'><span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span class='line'><span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="c"># see what&#39;s going on</span>
</span><span class='line'><span class="n">list_vals</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;,&quot;</span><span class="p">)]</span>
</span><span class='line'><span class="n">lights_start</span><span class="p">(</span><span class="o">*</span><span class="n">list_vals</span><span class="p">)</span>
</span><span class='line'><span class="c"># Likewise, self.wfile is a file-like object used to write back to the client</span>
</span><span class='line'><span class="bp">self</span><span class="o">.</span><span class="n">wfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;YES&quot;</span><span class="p">)</span> <span class="c"># acknowledge something&#39;s happening</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>When this script is served on the Raspberry Pi, wired to the lights in question, it can accept input from a client.</p>

<p>So this <code>handle()</code> method gets data: <code>self.data</code> .</p>

<p>We expect this to be a comma-separated string of six integer values: <code>bright, red, green, blue, rotate, sp</code> , as seen in <code>lights_start()</code> and <code>lights_do()</code> (above).</p>

<p>In line 4 in the snippet just above, <code>self.data = self.rfile.readline().strip()</code>, we take the arguments from the client and make them into a string stripped of whitespace on either end.</p>

<p>In line 6, <code>list_vals = [int(x) for x in self.data.split(",")]</code>, we split the string at the commas, into a list, making a list e.g. <code>['255','0','255','0','0','1']</code>. But each element of this list is of type <code>String</code>, so we use list comprehension syntax to make <code>list_vals</code> a list of integers (DMX expects integer values).</p>

<p>And in line 7, we call the function <code>lights_start()</code>, the wrapper function seen further above, which prepares to call <code>lights_do()</code> with any appropriate new values. We call it with the values passed to the server from the client: <code>*list_vals</code> is Python syntax to "unpack" an iterable like a list.</p>

<h2>the interface</h2>

<p>Wanting to make a quick web interface for sending the colors to the Pi server, we looked for a color picker wheel in JavaScript. Soon, the internet informed us that <code>color</code> is a built-in input value in HTML5.</p>

<p>"SWEET," I said. So, a hasty HTML form (we weren't playing designers here):</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;head&gt;&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;pre&gt;&lt;code&gt;</span><span class="ni">&amp;lt;</span>title<span class="ni">&amp;gt;</span>Pick a color<span class="ni">&amp;lt;</span>/title<span class="ni">&amp;gt;</span>
</span><span class='line'><span class="nt">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;p&gt;&lt;/head&gt;</span>
</span><span class='line'><span class="nt">&lt;body&gt;&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;pre&gt;&lt;code&gt;</span><span class="ni">&amp;lt;</span>form action=&quot;light.php&quot; method=&quot;post&quot;<span class="ni">&amp;gt;</span>
</span><span class='line'>    Choose Color:<span class="ni">&amp;lt;</span>br<span class="ni">&amp;gt;</span>
</span><span class='line'>    <span class="ni">&amp;lt;</span>input type=&quot;color&quot; name=&quot;color&quot;<span class="ni">&amp;gt;</span>
</span><span class='line'>    <span class="ni">&amp;lt;</span>br<span class="ni">&amp;gt;</span>
</span><span class='line'>    Brightness:
</span><span class='line'>    <span class="ni">&amp;lt;</span>br<span class="ni">&amp;gt;</span>
</span><span class='line'>    <span class="ni">&amp;lt;</span>input type=&quot;text&quot; name=&quot;bright&quot; value=&quot;255&quot;<span class="ni">&amp;gt;</span>
</span><span class='line'>    <span class="ni">&amp;lt;</span>br<span class="ni">&amp;gt;</span>
</span><span class='line'>    <span class="ni">&amp;lt;</span>input type=&quot;submit&quot; value=&quot;submit&quot;<span class="ni">&amp;gt;</span>
</span><span class='line'><span class="ni">&amp;lt;</span>/form<span class="ni">&amp;gt;</span>
</span><span class='line'><span class="nt">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;p&gt;&lt;/body&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>In the browser, this looks like:</p>

<p><img src="http://jaclynzetta.files.wordpress.com/2013/04/colorform_remotelighting.png"></p>

<p>We chose 255 as a default brightness, because that seemed overall most likely, and 0 -- black, or off, as a 'default' for all the color inputs.</p>

<p>(The special case options are not yet dealt with well in the interface, but that's easy enough to add, as would be a dropdown menu or slider for the brightness value, which here is just a text entry.)</p>

<p>That would get us a hex color value. We would need to convert that value to RGB. (The 0-255 integer values determining the colors -- of course, the input values for <code>red, green, blue</code> must always add up to 255 in total.) We decided to use PHP (mainly because my expertise, with regards to languages we used, was in Python, and my friend's, in PHP):</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">function</span> <span class="nf">hex2rgb</span><span class="p">(</span><span class="nv">$hex</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>   <span class="nv">$hex</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="nv">$hex</span><span class="p">);</span><span class="o">&lt;/</span><span class="nx">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span>   <span class="k">if</span><span class="p">(</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$hex</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span><span class="o">&lt;/</span><span class="nx">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">pre</span><span class="o">&gt;&lt;</span><span class="nx">code</span><span class="o">&gt;</span>  <span class="nv">$r</span> <span class="o">=</span> <span class="nx">hexdec</span><span class="p">(</span><span class="nx">substr</span><span class="p">(</span><span class="nv">$hex</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="nx">substr</span><span class="p">(</span><span class="nv">$hex</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">));</span>
</span><span class='line'>  <span class="nv">$g</span> <span class="o">=</span> <span class="nx">hexdec</span><span class="p">(</span><span class="nx">substr</span><span class="p">(</span><span class="nv">$hex</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="nx">substr</span><span class="p">(</span><span class="nv">$hex</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">));</span>
</span><span class='line'>  <span class="nv">$b</span> <span class="o">=</span> <span class="nx">hexdec</span><span class="p">(</span><span class="nx">substr</span><span class="p">(</span><span class="nv">$hex</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="nx">substr</span><span class="p">(</span><span class="nv">$hex</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">));</span>
</span><span class='line'><span class="o">&lt;/</span><span class="nx">code</span><span class="o">&gt;&lt;/</span><span class="nx">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span>   <span class="p">}</span> <span class="k">else</span> <span class="p">{</span><span class="o">&lt;/</span><span class="nx">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">pre</span><span class="o">&gt;&lt;</span><span class="nx">code</span><span class="o">&gt;</span>  <span class="nv">$r</span> <span class="o">=</span> <span class="nx">hexdec</span><span class="p">(</span><span class="nx">substr</span><span class="p">(</span><span class="nv">$hex</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">));</span>
</span><span class='line'>  <span class="nv">$g</span> <span class="o">=</span> <span class="nx">hexdec</span><span class="p">(</span><span class="nx">substr</span><span class="p">(</span><span class="nv">$hex</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">));</span>
</span><span class='line'>  <span class="nv">$b</span> <span class="o">=</span> <span class="nx">hexdec</span><span class="p">(</span><span class="nx">substr</span><span class="p">(</span><span class="nv">$hex</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">));</span>
</span><span class='line'><span class="o">&lt;/</span><span class="nx">code</span><span class="o">&gt;&lt;/</span><span class="nx">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span>   <span class="p">}</span>
</span><span class='line'>   <span class="nv">$rgb</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="nv">$r</span><span class="p">,</span> <span class="nv">$g</span><span class="p">,</span> <span class="nv">$b</span><span class="p">);</span>
</span><span class='line'>   <span class="c1">//return implode(&quot;,&quot;, $rgb); // returns the rgb values separated by commas</span>
</span><span class='line'>   <span class="k">return</span> <span class="nv">$rgb</span><span class="p">;</span> <span class="c1">// returns an array with the rgb values</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>So if a color was chosen on the interface, then we wanted to POST that RGB information, and whatever brightness was selected, to the server:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">if</span> <span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">])</span> <span class="p">{</span> <span class="c1">// if-statement begins&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">pre</span><span class="o">&gt;&lt;</span><span class="nx">code</span><span class="o">&gt;</span><span class="nv">$color</span> <span class="o">=</span> <span class="nx">hex2rgb</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]);</span>
</span><span class='line'><span class="nv">$bright</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;bright&#39;</span><span class="p">];</span>
</span><span class='line'><span class="o">&lt;/</span><span class="nx">code</span><span class="o">&gt;&lt;/</span><span class="nx">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>and, still in this if-statement, turn the returned array from <code>hex2rgb()</code> to a string separated by commas. The quick-n-dirty way:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;/</span><span class="nx">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">pre</span><span class="o">&gt;&lt;</span><span class="nx">code</span><span class="o">&gt;</span><span class="nv">$out</span> <span class="o">=</span> <span class="nv">$bright</span> <span class="o">.</span> <span class="s1">&#39;,&#39;</span> <span class="o">.</span> <span class="nv">$color</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">.</span> <span class="s1">&#39;,&#39;</span> <span class="o">.</span> <span class="nv">$color</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">.</span> <span class="s1">&#39;,&#39;</span> <span class="o">.</span> <span class="nv">$color</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">.</span> <span class="s1">&#39;,255,0&#39;</span><span class="p">;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="nx">code</span><span class="o">&gt;&lt;/</span><span class="nx">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>Then we create a file pointer to the open socket, and pass it the IP address of the Raspberry Pi and the appropriate port (which in our case, as you can see earlier in the post, was port 9999):</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;/</span><span class="nx">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">pre</span><span class="o">&gt;&lt;</span><span class="nx">code</span><span class="o">&gt;</span><span class="nv">$fp</span> <span class="o">=</span> <span class="nb">fsockopen</span><span class="p">(</span><span class="s1">&#39;xxx.xxx.xx.xx&#39;</span><span class="p">,</span><span class="s1">&#39;9999&#39;</span><span class="p">);</span> <span class="c1">// x-es represent the pi IP</span>
</span><span class='line'><span class="o">&lt;/</span><span class="nx">code</span><span class="o">&gt;&lt;/</span><span class="nx">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>And write it to the server:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;/</span><span class="nx">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">pre</span><span class="o">&gt;&lt;</span><span class="nx">code</span><span class="o">&gt;</span><span class="nb">fwrite</span><span class="p">(</span><span class="nv">$fp</span><span class="p">,</span> <span class="nv">$out</span><span class="p">);</span>
</span><span class='line'><span class="o">&lt;/</span><span class="nx">code</span><span class="o">&gt;&lt;/</span><span class="nx">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="p">}</span> <span class="c1">// if-statement ends here</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>Hooray! I don't have pictures, but it was pretty great.</p>

<p>We had a lot of fun with this project, and I think it's only made better by the facts that (a) we said 'hey, let's do this' and went and made it happen, and (b) this kind of reasonably simple affecting one's physical environment in fun ways using capabilities of a <a href="http://www.raspberrypi.org/faqs">Raspberry Pi</a> is, like the workshop with LEDs and photo sensors I briefly referred to the other day, a great way to show kids the possibilities that are available by learning a little bit about electronics and programming. Which are also GREAT, oh man.</p>

<p>Here's where the value I mentioned in explicit code comes in: it's great that it's easy to read what's happening without shoving too much information into one line, but it's even better that this makes it easy to explain, and thus easier to teach.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[A useful Ruby script (part I)]]></title>
    <link href="http://aerenchyma.github.io/blog/2013/04/15/a-useful-ruby-script-for-mapping-projects/"/>
    <updated>2013-04-15T11:46:00-04:00</updated>
    <id>http://aerenchyma.github.io/blog/2013/04/15/a-useful-ruby-script-for-mapping-projects</id>
    <content type="html"><![CDATA[<h2>once upon a time</h2>

<p>in late 2012, I was at a bar with some friends, but the night ended with some excitement.</p>

<p>Soon after I left, I began writing a script in order to put together .csv files of locations, names, and phone numbers of various types of sites within a certain radius! The exclamation point there is a little facetious, but the excitement isn't really. I'm writing about this largely because I think its greatest value was in its original, unpolished, somewhat inefficient state: what's inefficient to a computer is not necessarily so to a human, and it's easy for a programmer to forget that.</p>

<p>This is a project that's taken place in a couple parts, and due to various pending Terms-of-Service (TOS) agreements and new <a href="http://en.wikipedia.org/wiki/Api">API</a> developments, I won't be publishing the final version of the code online <em>yet.</em></p>

<p><a href="http://aerenchyma.github.io/blog/2013/04/15/a-useful-ruby-script-for-mapping-projects/">Part I</a> (this post) will address the basic technical architecture of writing a Ruby script to speed up data-gathering for a non-profit organization and the initial questions that led to the script writing. <a href="">Part II</a> (to come) will address the whys -- specifically, why Ruby worked pretty well for this project and what I found to be useful takeaways from it. I am especially interested in takeaways with respect to teaching programming, ways of looking at projects as a developer, and application of technical skills as a service. <a href="">Part III</a> (to come) will address further technical possibilities -- what should work better, and what further questions this generated.</p>

<!-- more -->


<h2>initiation</h2>

<p>"Is there a faster way?" my friend asked, wondering if there were a way to automate some data gathering her organization was doing. <em>Is there a faster way?</em>  The answer is usually yes.</p>

<p>My friend and the organization she worked for wanted a faster way to gather data for a mapping project: for example, amidst this project, they might want to gather .csv files that held lists of places of worship (e.g. churches, mosques, temples...), within the tri-county area of Southeastern Michigan. They would analyze and separate these data in various ways and upload the final files for a given search to <a href="http://www.arcgis.com/about/">ArcGIS</a>, in order to create maps.</p>

<p>The problems?</p>

<ol>
<li><p><strong>Getting the data was hard:</strong>
In some cases for mapping sites of given types or categories, the data was readily available. The governent provides data files, including GIS shape files, with a lot of publicly available information; beyond things like that, there are available lists from many public sources; lists of public schools and locations, for example. But it's hard to find a list of all <em>places of worship</em>, say, because though this may be one category at a given level, on an organizational level these belong to many different categories: churches of a given denomination and Sikh Temples are usually not listed in the same public dataset, especially not throughout the tri-county area.</p></li>
<li><p><strong>Getting the data was slow:</strong>
The way they were currently approaching these problems, she explained, was making educated searches for terms (e.g. places of worship) that weren't easily correlated in your average public database and which didn't have an overarching organization. When the resulting data wasn't available in a database or google spreadsheet form, they copied them into Excel and spot-checked them for accuracy, going back and searching. They were working on a lot of projects simultaneously and this process was turning into quite a timesink for some.</p></li>
</ol>


<p>Was there a faster way? <em>Yes</em>, I said.</p>

<p>There are many services, both specific to the state of Michigan or metro Detroit and nationally or internationally that provide open source mapping and data services: <a href="http://datadrivendetroit.org/">Data Driven Detroit</a>, <a href="http://datakind.org/">DataKind</a>, <a href="http://www.openstreetmap.org/">Open Street Map</a>, among others. There are also many technical solutions to any problem of creating maps, but for those (like me) immersed in technical solutions, it is easy to forget the time and energy it takes to reach the baseline for these tools (for example, <a href="http://postgis.net/">PostGIS</a>).<sup id='fnref:1'><a href='#fn:1' rel='footnote'>1</a></sup></p>

<p>However, some (not all) of these services are prohibitively expensive, some require a more intermediate level of technical skill for productive use than her organization could spare or hire, and most are dependent upon data collections already existing. Thus, her question. She and others were spending a lot of time copying and pasting that didn't need to be spent. The missing piece for a quicker finish for their project was a short -- but admittedly sharp -- learning curve. <em>You can write a script to do that</em>, I said, or at least thought. <em>I can write this -- it'll be fun.</em></p>

<p>Okay.</p>

<h2>first steps &amp; ethical questions</h2>

<p>The next question for me, the script-writer, then, was: is there a service that provides this information in a useful way, and do they have an API? The initial answers to this ("sort of") are what keep me from posting code in its entirety (and leave me hoping that things will soon improve), but common sense took me a step further. Neither the Google Places API nor the Maps API on their own provided results fine-grained enough for the numbers we were looking for, knowing that, for example, there are somewhere (give or take large numbers) around 4500 places of worship in the <a href="http://en.wikipedia.org/wiki/Metro_Detroit">tri-county area</a> of Southeastern Michigan. Okay -- what next?</p>

<p>Well, scraping, while useful, has the potential of stepping over TOS boundaries, not something we want -- on the "client" end as an organization, nor as a developer. Nor indeed as a decent person, I guess, though I admit this judgment could depend somewhat on the TOS. (Heh.) But spending potentially-hundreds of hours copying and pasting leads to <em>some</em> (not all) of the same ends as scraping does.</p>

<p>If public data is being shared, and it's not being used commercially<sup id='fnref:2'><a href='#fn:2' rel='footnote'>2</a></sup> , it is probably being gotten and used all the time. That's what we use a phone book for, the ones that the city leaves on our doorsteps in Ann Arbor: say, where are the nearest couple churches? Well...</p>

<p>Whatif we access a big service provider, I thought -- one that wouldn't have to <em>worry</em> about funding bandwidth for a hit of a few seconds, with engineered breaks -- what if we only hit the server once, really? Instead of leaving people to copy and paste for weeks and weeks? Say I save a sample couple html pages for testing. They just need the data faster -- they need to get their project done, and they would like to make it efficient. I can write a script that automates that human effort. Maybe they'll hit it once, or twice, thrice, not too quickly, not even within the same day, and do the rest of the analysis offline.<sup id='fnref:3'><a href='#fn:3' rel='footnote'>3</a></sup></p>

<h2>architecture basics</h2>

<p>I used the <a href="http://mechanize.rubyforge.org/">Mechanize</a> and <a href="http://nokogiri.org/">Nokogiri</a> gems for the original script: Mechanize to submit appropriate query/ies to forms, Nokogiri to parse the results displayed on webpages, and the rest is all scripting in Ruby 1.9.3. (1.9.x Ruby was important here, because of its <a href="http://www.igvita.com/2009/02/04/ruby-19-internals-ordered-hash/">ordered hashes</a>.)</p>

<p>First, initialization of a Mechanize agent:</p>

<p><code>ruby
$agent = Mechanize.new
</code></p>

<p>I used this agent in several smaller scopes and thus (yes, I can hear the scolding; I accept it) made it global for the moment.</p>

<p>Then, saving a query in a variable like so:</p>

<p><code>ruby
query = "community center" # example
</code></p>

<p>Then, I access the page's forms to allow me to search for a query (in this case, the first form on the page was the relevant one for information we were interested in). For example,</p>

<p><code>ruby
page = $agent.get('http://YOURURL.com')
forms = page.forms
searchform = forms.first
searchform.search_terms = query
results = $agent.submit(searchform)
start_pg = results.uri # this is the page to start scraping from
</code></p>

<p>(Note that <strong>search_terms</strong> here is specific to the form. You'll want to take a look at the form(s), perhaps by <code>forms.each do {|f| p f}</code> in the console, to see what the appropriate entry box is <em>named</em> on the web form you're trying to enter a query in.</p>

<p>Also note that a form may have several fields you need to enter -- say, a search term and location -- and you'll need to look for all of those fields and write a line similar to that in line 4 in the snippet above for each.)</p>

<p>Immediately after this, I throw the results into a Nokogiri document for ease of parsing HTML to pull out relevant information, since the result web pages are intended for end-user viewers and not in easy-to-parse XML or JSON like you would get from the result of an API.</p>

<p><code>
pg = Nokogiri::HTML(open(start_pg)) # Nokogiri document of the start page
</code></p>

<p>Next, I have a <code>create_hashes(page)</code> function which expects a Nokogiri document (e.g. <code>pg</code> ) as a parameter. This function uses Nokogiri functionality to grab different pieces of information that we cared about -- e.g. the name of a given place, its address, its phone number. The function handles exceptions and keeps count of the individual results gathered.<sup id='fnref:4'><a href='#fn:4' rel='footnote'>4</a></sup></p>

<p>So <code>create_hashes</code> calls another function to make sure no duplicate entries are included in any set of .csv files corresponding to the the same search. It then pulls all associated pieces of information into a Ruby hash data structure and adds that to a Ruby array of hashes, each of which corresponds to one result (one church, for example).</p>

<p>For instance, one hash might look like:</p>

<p><code>ruby
{ "name" =&gt; "Generic Church Name", "addr" =&gt; "1000 Streetname Dr", "city" =&gt; "Detroit", "state" =&gt; "MI", "zip" =&gt; "48126", "phone" =&gt; "555-555-5555" }
</code></p>

<p><font size="-3">n.b. that is NOT a real address or phone number</font></p>

<p>I have a function <code>transform_hash(hn)</code>, where <code>hn</code> is a hash corresponding to a single result, which transforms one of the aggregated hashes into a line in a .csv file. In the case of the information I was gathering, that looked like:</p>

<p><code>ruby
def transform_hash(hn)
  s = "#{hn['name']}, #{hn['addr']}, #{hn['city']}, #{hn['state']}, #{hn['zip']}, #{hn['phone']}\n"
  s
end
</code></p>

<p>And I make sure that every .csv file created has the form of {date search occurred}-{location for search}-{search query}{#, if there are > 1000 unique results}, so I create a filename and open a new file with that filename for writing.</p>

<p><font size="-3">( <code>today_string()</code> is a function which creates a string of the current date in the string format I wanted: YYYY-MM-DD)</font></p>

<p><code>ruby
fname = today_string() + "-" + location.gsub!(",","").split(' ').map {|w| CGI.escape(w)}.join("") + query.split(' ').map {|w| CGI.escape(w)}.join("")
</code></p>

<p>And finally, the script writes .csv files as appropriate, starting a new file with the header ( <code>Name, Address, City, State, Phone</code> ) each time one file reaches 990 entries (AKA 991 lines).</p>

<h2>discussion</h2>

<p>This script I typed out on first go, post the original discussion with my friend, is not exactly the code I'm most proud of from a technical perspective: programmatically, I don't think there's a great deal to learn for someone who is already confident with web programming in Ruby.</p>

<p>So while I’m always pleased to write good-smelling code<sup id='fnref:5'><a href='#fn:5' rel='footnote'>5</a></sup>, I honestly saw this whole scenario through rose-colored glasses because it <em>worked</em>, even though I didn’t spend a ton of hours honing it; I knew there was a possibility here so I sat down and wrote it and ran it and it helped, and that was what mattered.</p>

<p>My friend and her team needed something that worked better (in this case, “better” meant faster – and potentially more reliable) than their previous method(s) of data-gathering. I believe this solution satisfied that without crawling rudely or putting undue weight anywhere except an individual computer for a minute or so. (That is to say, it wasn't as efficient as it really ought to be, and while it is a sustainable solution in some senses, it isn't in others. More on this to follow.)</p>

<p>And thus I like this as an example of a good <em>use</em> of programming skill. A web app for this is in progress, but the process of hacking together a solution to this problem was valuable to me as a programmer.</p>

<p>Is there a faster way? Yes. This script brought down the team's time expectation for the mapping project from months to days.</p>

<p>And there are lessons to be gained for your average programmer from this small project. Maybe I'd wince to ship this and maybe I wouldn't, but in this particular case, it <em>should</em> have been shipped: it did all it needed to do for the small scope we assigned it.<sup id='fnref:6'><a href='#fn:6' rel='footnote'>6</a></sup> It also made me think seriously about what important questions are for a developer when the end-user is someone running a (simple? perhaps yes!) script on the command line, especially if that person is not necessarily <em>comfortable</em> with its use.</p>

<p>What's the input? What's the output? How does the API work? What's the easiest solution, the fastest solution, the most elegant?</p>

<p>It's easy to get caught up in jargon just answering these questions. While there is <em>usually</em> reason to have these in-depth discussions, there do exist occurrences when they are a hinderance and not a help, at least not right away. Not a lot of programmers or computer scientists work in the non-profit industry overall, especially not in jobs where technology isn't the end goal of their particular projects. But programming skill can still be valuable there, and these kind of caveats (what questions not to ask, which performance issues (not) to worry about first...) are useful to keep in mind.</p>

<hr />

<p>Find <a href="">Part II</a> and <a href="">Part III</a></p>

<hr />

<p><div class="footnotes">
	<ol>
		<li id='fn:1'><p> I'll come back to this issue in Part II
<a href='#fnref:1' rev='footnote'>↩</a></p>
</li><li id='fn:2'><p> Arguably, not even in other creative works -- but this is a whole 'nother issue so we'll leave that aside for the moment
<a href='#fnref:2' rev='footnote'>↩</a></p>
</li><li id='fn:3'><p> Note: no TOS was violated in the making of this script, but it is somewhat unclear for the current incarnation, thus the pause and non-public full code.
<a href='#fnref:3' rev='footnote'>↩</a></p>
</li><li id='fn:4'><p> The count is kept specifically because the results were intended for use with ArcGIS, which, for the organization's current tools, worked best with .CSV files of 1000 lines or fewer.
<a href='#fnref:4' rev='footnote'>↩</a></p>
</li><li id='fn:5'><p> <a href="http://en.wikipedia.org/wiki/Code_smell">On code smell</a> -- thanks to David Albert for my introduction to the term
<a href='#fnref:5' rev='footnote'>↩</a></p>
</li><li id='fn:6'><p> I still welcome what code reviews are possible without posting most of the code, and/or comments or suggestions. It <em>will</em> all be open-source under the MIT license.
<a href='#fnref:6' rev='footnote'>↩</a></p>
</li>
	</ol>
</div>
</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[instabitly]]></title>
    <link href="http://aerenchyma.github.io/blog/2013/03/25/instabitly/"/>
    <updated>2013-03-25T00:29:00-04:00</updated>
    <id>http://aerenchyma.github.io/blog/2013/03/25/instabitly</id>
    <content type="html"><![CDATA[<p>Quick drive-by: <a href="https://github.com/aerenchyma/instabitly">instabitly</a>, a script I wrote recently to import saved links from <a href="http://instapaper.com">Instapaper</a> to <a href="https://bitly.com/">bit.ly</a>.</p>

<p>I did it for personal reasons -- primarily because I want all this stuff stored redundantly. Obviously I haven't solved that problem in its entirety, but there were also other reasons. Because I care about things like this. There's a README. More, like more in the other documentation series I've discussed so far, will have to appear after recent projects calm down some.</p>

<p>Let me also take this opportunity to encourage you to <a href="http://www.instapaper.com/subscription">support Instapaper</a> if you can and it's a service you like/use.</p>

<p>In my imaginary free time, I have been trying to absorb all the <a href="http://pyvideo.org/category/33/pycon-us-2013">fantastic PyCon</a> <a href="https://speakerdeck.com/pyconslides">talks</a> (I have an active imagination).</p>
]]></content>
  </entry>
  
</feed>
